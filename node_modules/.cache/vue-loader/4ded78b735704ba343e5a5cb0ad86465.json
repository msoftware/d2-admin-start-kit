{"remainingRequest":"C:\\Projekte\\vue-admin\\d2-admin-start-kit\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Projekte\\vue-admin\\d2-admin-start-kit\\src\\layout\\header-aside\\components\\panel-search\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Projekte\\vue-admin\\d2-admin-start-kit\\src\\layout\\header-aside\\components\\panel-search\\index.vue","mtime":1593434353510},{"path":"C:\\Projekte\\vue-admin\\d2-admin-start-kit\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Projekte\\vue-admin\\d2-admin-start-kit\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Projekte\\vue-admin\\d2-admin-start-kit\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Projekte\\vue-admin\\d2-admin-start-kit\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgRnVzZSBmcm9tICdmdXNlLmpzJw0KaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICd2dWV4Jw0KaW1wb3J0IG1peGluIGZyb20gJy4uL21peGluL21lbnUnDQpleHBvcnQgZGVmYXVsdCB7DQogIG1peGluczogWw0KICAgIG1peGluDQogIF0sDQogIGNvbXBvbmVudHM6IHsNCiAgICAnZDItcGFuZWwtc2VhcmNoLWl0ZW0nOiAoKSA9PiBpbXBvcnQoJy4vY29tcG9uZW50cy9wYW5lbC1zZWFyY2gtaXRlbS9pbmRleC52dWUnKQ0KICB9LA0KICBkYXRhICgpIHsNCiAgICByZXR1cm4gew0KICAgICAgc2VhcmNoVGV4dDogJycsDQogICAgICByZXN1bHRzOiBbXQ0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICAuLi5tYXBTdGF0ZSgnZDJhZG1pbi9zZWFyY2gnLCBbDQogICAgICAnaG90a2V5JywNCiAgICAgICdwb29sJw0KICAgIF0pLA0KICAgIC8vIOi/meS7veaVsOaNruaYr+WxleekuuWcqOaQnOe0oumdouadv+S4i+mdoueahA0KICAgIHJlc3VsdHNMaXN0ICgpIHsNCiAgICAgIHJldHVybiAodGhpcy5yZXN1bHRzLmxlbmd0aCA9PT0gMCAmJiB0aGlzLnNlYXJjaFRleHQgPT09ICcnKSA/IHRoaXMucG9vbC5tYXAoZSA9PiAoew0KICAgICAgICB2YWx1ZTogZS5mdWxsVGl0bGUsDQogICAgICAgIC4uLmUNCiAgICAgIH0pKSA6IHRoaXMucmVzdWx0cw0KICAgIH0sDQogICAgLy8g5qC55o2uIHBvb2wg5pu05pawIGZ1c2Ug5a6e5L6LDQogICAgZnVzZSAoKSB7DQogICAgICByZXR1cm4gbmV3IEZ1c2UodGhpcy5wb29sLCB7DQogICAgICAgIHNob3VsZFNvcnQ6IHRydWUsDQogICAgICAgIHRva2VuaXplOiB0cnVlLA0KICAgICAgICB0aHJlc2hvbGQ6IDAuNiwNCiAgICAgICAgbG9jYXRpb246IDAsDQogICAgICAgIGRpc3RhbmNlOiAxMDAsDQogICAgICAgIG1heFBhdHRlcm5MZW5ndGg6IDMyLA0KICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGg6IDEsDQogICAgICAgIGtleXM6IFsNCiAgICAgICAgICAnZnVsbFRpdGxlJywNCiAgICAgICAgICAncGF0aCcNCiAgICAgICAgXQ0KICAgICAgfSkNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24g6L+H5ruk6YCJ6aG5IOi/meS4quaWueazleWcqOavj+asoei+k+WFpeahhueahOWAvOWPkeeUn+WPmOWMluaXtuS8muinpuWPkQ0KICAgICAqLw0KICAgIHF1ZXJ5U2VhcmNoIChxdWVyeVN0cmluZywgY2FsbGJhY2spIHsNCiAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmZ1c2Uuc2VhcmNoKHF1ZXJ5U3RyaW5nKS5tYXAoZSA9PiBlLml0ZW0pDQogICAgICB0aGlzLnJlc3VsdHMgPSByZXN1bHRzDQogICAgICBjYWxsYmFjayhyZXN1bHRzKQ0KICAgIH0sDQogICAgLyoqDQogICAgICogQGRlc2NyaXB0aW9uIOiBmueEpui+k+WFpeahhg0KICAgICAqLw0KICAgIGZvY3VzICgpIHsNCiAgICAgIHRoaXMuaW5wdXQgPSAnJw0KICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGlmICh0aGlzLiRyZWZzLmlucHV0KSB7DQogICAgICAgICAgdGhpcy4kcmVmcy5pbnB1dC5mb2N1cygpDQogICAgICAgIH0NCiAgICAgICAgLy8g6L+Y5Y6fDQogICAgICAgIHRoaXMuc2VhcmNoVGV4dCA9ICcnDQogICAgICAgIHRoaXMucmVzdWx0cyA9IFtdDQogICAgICB9LCA1MDApDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAZGVzY3JpcHRpb24g5o6l5pS255So5oi35Zyo5YiX6KGo5Lit6YCJ5oup6aG555uu55qE5LqL5Lu2DQogICAgICovDQogICAgaGFuZGxlUmVzdWx0c0dyb3VwSXRlbUNsaWNrIChwYXRoKSB7DQogICAgICAvLyDlpoLmnpznlKjmiLfpgInmi6nnmoTlsLHmmK/lvZPliY3pobXpnaIg5bCx55u05o6l5YWz6Zet5pCc57Si6Z2i5p2/DQogICAgICBpZiAocGF0aCA9PT0gdGhpcy4kcm91dGUucGF0aCkgew0KICAgICAgICB0aGlzLmhhbmRsZUVzYygpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgLy8g55So5oi36YCJ5oup55qE5piv5YW25a6D6aG16Z2iDQogICAgICB0aGlzLmhhbmRsZU1lbnVTZWxlY3QocGF0aCkNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBkZXNjcmlwdGlvbiDmjqXmlLbnlKjmiLflnKjkuIvmi4noj5zljZXkuK3pgInkuK3kuovku7YNCiAgICAgKi8NCiAgICBhc3luYyBoYW5kbGVTZWxlY3QgKHsgcGF0aCB9KSB7DQogICAgICAvLyDlpoLmnpznlKjmiLfpgInmi6nnmoTlsLHmmK/lvZPliY3pobXpnaIg5bCx55u05o6l5YWz6Zet5pCc57Si6Z2i5p2/DQogICAgICBpZiAocGF0aCA9PT0gdGhpcy4kcm91dGUucGF0aCkgew0KICAgICAgICB0aGlzLmhhbmRsZUVzYygpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgLy8g55So5oi36YCJ5oup55qE5piv5YW25a6D6aG16Z2iDQogICAgICBhd2FpdCB0aGlzLiRuZXh0VGljaygpDQogICAgICB0aGlzLmhhbmRsZU1lbnVTZWxlY3QocGF0aCkNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEBhdWdtZW50cyDlhbPpl63ovpPlhaXmoYbnmoTkuIvmi4noj5zljZUNCiAgICAgKi8NCiAgICBjbG9zZVN1Z2dlc3Rpb24gKCkgew0KICAgICAgaWYgKHRoaXMuJHJlZnMuaW5wdXQuYWN0aXZhdGVkKSB7DQogICAgICAgIHRoaXMuJHJlZnMuaW5wdXQuc3VnZ2VzdGlvbnMgPSBbXQ0KICAgICAgICB0aGlzLiRyZWZzLmlucHV0LmFjdGl2YXRlZCA9IGZhbHNlDQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAYXVnbWVudHMg5o6l5pS255So5oi354K55Ye756m655m95Yy65Z+f55qE5YWz6ZetDQogICAgICovDQogICAgaGFuZGxlUGFuZWxDbGljayAoKSB7DQogICAgICB0aGlzLmhhbmRsZUVzYygpDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBAYXVnbWVudHMg5o6l5pS255So5oi36Kem5Y+R55qE5YWz6ZetDQogICAgICovDQogICAgYXN5bmMgaGFuZGxlRXNjICgpIHsNCiAgICAgIHRoaXMuY2xvc2VTdWdnZXN0aW9uKCkNCiAgICAgIGF3YWl0IHRoaXMuJG5leHRUaWNrKCkNCiAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlJykNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/layout/header-aside/components/panel-search","sourcesContent":["<template>\r\n  <div class=\"panel-search\" flex=\"dir:top\">\r\n    <div class=\"panel-search__input-group\" flex-box=\"0\" flex=\"dir:top main:center cross:center\" @click.self=\"handlePanelClick\">\r\n      <d2-icon-svg class=\"panel-search__logo\" name=\"d2-admin-text\"/>\r\n      <el-autocomplete\r\n        class=\"panel-search__input\"\r\n        ref=\"input\"\r\n        v-model=\"searchText\"\r\n        suffix-icon=\"el-icon-search\"\r\n        placeholder=\"搜索页面\"\r\n        :fetch-suggestions=\"querySearch\"\r\n        :trigger-on-focus=\"false\"\r\n        :clearable=\"true\"\r\n        @keydown.esc.native=\"handleEsc\"\r\n        @select=\"handleSelect\">\r\n        <d2-panel-search-item slot-scope=\"{ item }\" :item=\"item\"/>\r\n      </el-autocomplete>\r\n      <div class=\"panel-search__tip\">\r\n        您可以使用快捷键\r\n        <span class=\"panel-search__key\">{{hotkey.open}}</span>\r\n        唤醒搜索面板，按\r\n        <span class=\"panel-search__key\">{{hotkey.close}}</span>\r\n        关闭\r\n      </div>\r\n    </div>\r\n    <div v-if=\"resultsList.length > 0\" class=\"panel-search__results-group\" flex-box=\"1\">\r\n      <el-card shadow=\"never\">\r\n        <div class=\"panel-search__results-group-inner\">\r\n          <d2-panel-search-item\r\n            v-for=\"(item, index) in resultsList\"\r\n            :key=\"index\"\r\n            :item=\"item\"\r\n            :hover-mode=\"true\"\r\n            @click.native=\"handleResultsGroupItemClick(item.path)\"/>\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Fuse from 'fuse.js'\r\nimport { mapState } from 'vuex'\r\nimport mixin from '../mixin/menu'\r\nexport default {\r\n  mixins: [\r\n    mixin\r\n  ],\r\n  components: {\r\n    'd2-panel-search-item': () => import('./components/panel-search-item/index.vue')\r\n  },\r\n  data () {\r\n    return {\r\n      searchText: '',\r\n      results: []\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState('d2admin/search', [\r\n      'hotkey',\r\n      'pool'\r\n    ]),\r\n    // 这份数据是展示在搜索面板下面的\r\n    resultsList () {\r\n      return (this.results.length === 0 && this.searchText === '') ? this.pool.map(e => ({\r\n        value: e.fullTitle,\r\n        ...e\r\n      })) : this.results\r\n    },\r\n    // 根据 pool 更新 fuse 实例\r\n    fuse () {\r\n      return new Fuse(this.pool, {\r\n        shouldSort: true,\r\n        tokenize: true,\r\n        threshold: 0.6,\r\n        location: 0,\r\n        distance: 100,\r\n        maxPatternLength: 32,\r\n        minMatchCharLength: 1,\r\n        keys: [\r\n          'fullTitle',\r\n          'path'\r\n        ]\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n     * @description 过滤选项 这个方法在每次输入框的值发生变化时会触发\r\n     */\r\n    querySearch (queryString, callback) {\r\n      const results = this.fuse.search(queryString).map(e => e.item)\r\n      this.results = results\r\n      callback(results)\r\n    },\r\n    /**\r\n     * @description 聚焦输入框\r\n     */\r\n    focus () {\r\n      this.input = ''\r\n      setTimeout(() => {\r\n        if (this.$refs.input) {\r\n          this.$refs.input.focus()\r\n        }\r\n        // 还原\r\n        this.searchText = ''\r\n        this.results = []\r\n      }, 500)\r\n    },\r\n    /**\r\n     * @description 接收用户在列表中选择项目的事件\r\n     */\r\n    handleResultsGroupItemClick (path) {\r\n      // 如果用户选择的就是当前页面 就直接关闭搜索面板\r\n      if (path === this.$route.path) {\r\n        this.handleEsc()\r\n        return\r\n      }\r\n      // 用户选择的是其它页面\r\n      this.handleMenuSelect(path)\r\n    },\r\n    /**\r\n     * @description 接收用户在下拉菜单中选中事件\r\n     */\r\n    async handleSelect ({ path }) {\r\n      // 如果用户选择的就是当前页面 就直接关闭搜索面板\r\n      if (path === this.$route.path) {\r\n        this.handleEsc()\r\n        return\r\n      }\r\n      // 用户选择的是其它页面\r\n      await this.$nextTick()\r\n      this.handleMenuSelect(path)\r\n    },\r\n    /**\r\n     * @augments 关闭输入框的下拉菜单\r\n     */\r\n    closeSuggestion () {\r\n      if (this.$refs.input.activated) {\r\n        this.$refs.input.suggestions = []\r\n        this.$refs.input.activated = false\r\n      }\r\n    },\r\n    /**\r\n     * @augments 接收用户点击空白区域的关闭\r\n     */\r\n    handlePanelClick () {\r\n      this.handleEsc()\r\n    },\r\n    /**\r\n     * @augments 接收用户触发的关闭\r\n     */\r\n    async handleEsc () {\r\n      this.closeSuggestion()\r\n      await this.$nextTick()\r\n      this.$emit('close')\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.panel-search {\r\n  margin: 20px;\r\n  width: 100%;\r\n  .panel-search__input-group {\r\n    height: 240px;\r\n    .panel-search__logo {\r\n      width: 80px;\r\n      height: 80px;\r\n      margin-bottom: 20px;\r\n    }\r\n    .panel-search__input {\r\n      width: 500px;\r\n    }\r\n    .panel-search__tip {\r\n      @extend %unable-select;\r\n      margin-top: 20px;\r\n      margin-bottom: 40px;\r\n      font-size: 12px;\r\n      color: $color-text-sub;\r\n      .panel-search__key {\r\n        padding: 1px 5px;\r\n        margin: 0px 2px;\r\n        border-radius: 2px;\r\n        background-color: $color-text-normal;\r\n        color: $color-bg;\r\n      }\r\n    }\r\n  }\r\n  .panel-search__results-group {\r\n    overflow: auto;\r\n    margin-bottom: -20px;\r\n    .panel-search__results-group-inner {\r\n      margin: -20px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}